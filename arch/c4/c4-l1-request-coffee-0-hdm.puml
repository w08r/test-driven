@startuml "c4-l2-request-coffee-0-hdm"
!include c4lib/C4_Container.puml
LAYOUT_TOP_DOWN()
LAYOUT_AS_SKETCH()
''LAYOUT_WITH_LEGEND()

Person(worker, "Thirsty Worker", "Needs coffee to function.")
Person(family, "Resourceful Family Member", "Likes to take advantage of kettle being switched on.")
Lay_L(family, worker)

System_Ext(iam, "Identity and Access", "Allows folks needing a drink to identify themselves and assert they have permission to make a drink.  If they are a child, they have a hot-chocolate quota which must not be exceeded.")
Rel(worker, iam, "Authenticate", "[https]", "A token will be returned authenticating the user.")
Rel(family, iam, "Authenticate", "[https]", "A token will be returned authenticating the user.")
System_Boundary(cm, "HotDrinkMaker") {
    Container(om, "OrderManager", "GoLang", "Allows users to make orders.")
    Container(ks, "KettleService", "GoLang", "Provides hot water.")
    Container(cgs, "CoffeeGrinderService", "GoLang", "Grinds the right amount of coffee for the order.")
    Container(brs, "BeanRoastingService", "GoLang", "Roasts a daily supply of beans.")
    Container(bs, "BrewingService", "GoLang", "Brews coffee and dispatches to delivery.")
}
Rel(om, ks, "Boil water", "[https]", "Verifies the token supplied is valid.")
Rel(om, iam, "Verify", "[https]", "Verifies the token supplied is valid.")

System_Ext(d, "Delivery", "Place fresh hot drink on the correct coaster based on consumer location.")
Rel_U(d, worker, "delivers to", "[async message]")
Rel_U(d, family, "delivers to", "[async message]")

System_Ext(p, "Purchasing", "Order supplies such as green coffee beans from suppliers, such as amazon")

Lay_L(iam, p)
Lay_L(p, d)

Rel(worker, om, "Sends coffee request", "[https]", "Coffee will be delivered asynchronously when ready.")
Rel(family, om, "Makes additional request(s)", "[https]", "Drink will be delivered asynchronously when ready.")
Rel(cm, p, "Notifies purchasing system to obtain supplies", "[https]")
Rel_U(p, cm, "Provides new inventory", "[async message]")
Rel(bs, d, "Delivers coffee using", "[async message]")

@enduml
